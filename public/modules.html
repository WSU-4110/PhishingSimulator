<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mandatory Training Modules</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f9f9f9;
      padding: 30px;
      color: #333;
    }
    h1 {
      color: #2c3e50;
      margin-bottom: 20px;
    }
    .tabs {
      border-bottom: 2px solid #2980b9;
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      cursor: pointer;
    }
    .tab {
      padding: 10px 20px;
      background: #e1e8f0;
      border-radius: 20px 20px 0 0;
      color: #2980b9;
      font-weight: 600;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .tab:hover {
      background: #d0d9e7;
    }
    .tab.active {
      background: #2980b9;
      color: white;
      font-weight: 700;
    }
    .tab.disabled-tab {
      pointer-events: none;
      background: #ccc;
      color: #888;
      cursor: not-allowed;
    }
    .module {
      background: #ffffff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0px 2px 8px rgba(0,0,0,0.1);
      display: none;
    }
    .module.active {
      display: block;
    }
    iframe {
      width: 100%;
      height: 315px;
      border: none;
      border-radius: 8px;
    }
    .complete-btn {
      display: inline-block;
      margin-top: 10px;
      padding: 10px 20px;
      background-color: #ccc;
      color: #666;
      border: none;
      border-radius: 20px;
      text-decoration: none;
      cursor: not-allowed;
    }
    .complete-btn.enabled {
      background-color: #38d39f;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>Mandatory Security Awareness Training</h1>

<div class="tabs">
  <div class="tab" data-tab="1">Recognizing Phishing</div>
  <div class="tab disabled-tab" data-tab="2">Voice Phishing</div>
  <div class="tab disabled-tab" data-tab="3">Safe Browsing</div>
  <div class="tab disabled-tab" data-tab="4">Text Message Phishing</div>
</div>

<!-- MODULE 1 -->
<div class="module active" data-content="1">
  <h2>Module 1: Recognizing Phishing Attacks</h2>
  <p>Understand how phishing works and how to identify suspicious emails.</p>
  <iframe src="https://www.youtube.com/embed/Gcpe0F1dHaM?si=dnzvkF0rO21pEGfc" title="Recognizing Phishing Emails"></iframe>

  <div class="quiz">
    <h3>Quick Quiz</h3>
    <p><strong>1. What is a common sign of a phishing email?</strong></p>
    <label><input type="radio" name="q1" value="a"> A friendly greeting</label><br>
    <label><input type="radio" name="q1" value="b"> A request for urgent action or personal info</label><br>
    <label><input type="radio" name="q1" value="c"> A newsletter subscription</label><br>
    <button class="quiz-submit" data-question="1" data-correct="b">Submit Answer</button>
    <p id="feedback1"></p>
  </div>

  <button class="complete-btn" data-btn="1" disabled>Mark as Complete</button>
</div>

<!-- MODULE 2 -->
<div class="module" data-content="2">
  <h2>Module 2: Being phished via phone calls</h2>
  <p>Understand vishing and how to identify suspicious calls.</p>
  <iframe src="https://www.youtube.com/embed/JE5NJPoD0aE?si=dfoudEGWEdyhhn4d" title="Voice Phishing"></iframe>

  <div class="quiz">
    <h3>Quick Quiz</h3>
    <p><strong>2. What‚Äôs a red flag in a phone call that could indicate phishing?</strong></p>
    <label><input type="radio" name="q2" value="a"> Caller is polite</label><br>
    <label><input type="radio" name="q2" value="b"> Caller offers you a reward</label><br>
    <label><input type="radio" name="q2" value="c"> Caller asks for confidential info or passwords</label><br>
    <button class="quiz-submit" data-question="2" data-correct="c">Submit Answer</button>
    <p id="feedback2"></p>
  </div>

  <button class="complete-btn" data-btn="2" disabled>Mark as Complete</button>
</div>

<!-- MODULE 3 -->
<div class="module" data-content="3">
  <h2>Module 3: Safe Browsing Habits</h2>
  <p>Best practices for staying safe online at work and home.</p>
  <iframe src="https://www.youtube.com/embed/XvjXEwr1P7E?si=HVsMILWJ-L9WUUyt" title="Safe Browsing"></iframe>

  <div class="quiz">
    <h3>Quick Quiz</h3>
    <p><strong>3. Which of the following is a safe browsing habit?</strong></p>
    <label><input type="radio" name="q3" value="a"> Clicking unknown links</label><br>
    <label><input type="radio" name="q3" value="b"> Using strong, unique passwords and keeping software updated</label><br>
    <label><input type="radio" name="q3" value="c"> Ignoring browser warnings</label><br>
    <button class="quiz-submit" data-question="3" data-correct="b">Submit Answer</button>
    <p id="feedback3"></p>
  </div>

  <button class="complete-btn" data-btn="3" disabled>Mark as Complete</button>
</div>

<!-- MODULE 4 -->
<div class="module" data-content="4">
  <h2>Module 4: Smishing</h2>
  <p>Understanding what smishing is and how to spot suspicious text messages.</p>
  <iframe src="https://www.youtube.com/embed/oK0KwS8N108?si=psHpLyEXIKmPFee8" title="Text Message Phishing"></iframe>

  <div class="quiz">
    <h3>Quick Quiz</h3>
    <p><strong>4. What is ‚Äúsmishing‚Äù?</strong></p>
    <label><input type="radio" name="q4" value="a"> Phishing by email</label><br>
    <label><input type="radio" name="q4" value="b"> Phishing through SMS or text messages</label><br>
    <label><input type="radio" name="q4" value="c"> A secure message</label><br>
    <button class="quiz-submit" data-question="4" data-correct="b">Submit Answer</button>
    <p id="feedback4"></p>
  </div>

  <button class="complete-btn" data-btn="4" disabled>Mark as Complete</button>
</div>

<!-- COMPLETION PAGE -->
<!-- COMPLETION PAGE -->
<div id="completion" style="display:none; text-align:center; padding: 40px;">
  <h2>üéâ All Modules Complete!</h2>
  <p>You've successfully completed the Security Awareness Training.</p>
  <div style="margin-top: 30px;">
    <span style="font-size: 2.5rem; margin: 10px;">üèÖ</span>
    <span style="font-size: 2.5rem; margin: 10px;">üèÖ</span>
    <span style="font-size: 2.5rem; margin: 10px;">üèÖ</span>
    <span style="font-size: 2.5rem; margin: 10px;">üèÖ</span>
    <p style="margin-top: 10px; font-weight: bold;">Well done! You earned all 4 badges!</p>
    <p style="margin-top: 10px; font-weight: underline;">You may now exit this page.</p>
  </div>
</div>

<script>
  const tabs = document.querySelectorAll('.tab');
  const modules = document.querySelectorAll('.module');
  const completionPage = document.getElementById('completion');
  let completedModules = 0;

  const userEmail = localStorage.getItem('employeeEmail') || 'guest_user';
  const progressKey = `trainingProgress_${userEmail}`;

  let userProgress = JSON.parse(localStorage.getItem(progressKey)) || {
    completed: [],
    currentTab: "1"
  };

  function updateProgressStorage() {
    localStorage.setItem(progressKey, JSON.stringify(userProgress));
  }

  function activateTab(tabNum) {
    tabs.forEach(tab => tab.classList.remove('active'));
    modules.forEach(mod => mod.classList.remove('active'));

    document.querySelector(`.tab[data-tab="${tabNum}"]`).classList.add('active');
    document.querySelector(`.module[data-content="${tabNum}"]`).classList.add('active');

    userProgress.currentTab = tabNum;
    updateProgressStorage();
  }

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const tabNum = tab.getAttribute('data-tab');
      if (!tab.classList.contains('disabled-tab')) {
        activateTab(tabNum);
      }
    });
  });

  function enableTab(tabNum) {
    const tab = document.querySelector(`.tab[data-tab="${tabNum}"]`);
    if (tab) {
      tab.classList.remove('disabled-tab');
    }
  }

  function showCompletionPage() {
    document.querySelector('.tabs').style.display = 'none';
    modules.forEach(m => m.style.display = 'none');
    completionPage.style.display = 'block';
  }

  function markModuleAsCompleted(moduleNum) {
    if (!userProgress.completed.includes(moduleNum)) {
      userProgress.completed.push(moduleNum);
      updateProgressStorage();

      // Unlock next tab
      const nextTab = parseInt(moduleNum) + 1;
      enableTab(nextTab);

      completedModules++;
      if (completedModules === 4) showCompletionPage();

      // Send to server
      fetch('/api/submit-result', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: userEmail,
          moduleName: `Module ${moduleNum}`,
          score: 100,
          timestamp: new Date().toISOString()
        })
      }).catch(err => console.error('Server error:', err));
    }
  }

  // Quiz check + completion button logic
  document.querySelectorAll('.quiz-submit').forEach(button => {
    button.addEventListener('click', () => {
      const questionNum = button.dataset.question;
      const correct = button.dataset.correct;
      const selected = document.querySelector(`input[name="q${questionNum}"]:checked`);
      const feedback = document.getElementById(`feedback${questionNum}`);
      const completeBtn = document.querySelector(`.complete-btn[data-btn="${questionNum}"]`);

      if (!selected) {
        feedback.innerText = "Please select an answer.";
        feedback.style.color = "orange";
        return;
      }

      if (selected.value === correct) {
        feedback.innerText = "Correct! ‚úÖ";
        feedback.style.color = "green";
        completeBtn.classList.add('enabled');
        completeBtn.disabled = false;

        document.querySelectorAll(`input[name="q${questionNum}"]`).forEach(i => i.disabled = true);

        completeBtn.addEventListener('click', () => {
          if (completeBtn.classList.contains('enabled')) {
            markModuleAsCompleted(questionNum);
            const nextTab = document.querySelector(`.tab[data-tab="${parseInt(questionNum)+1}"]`);
            if (nextTab && !nextTab.classList.contains('disabled-tab')) {
              nextTab.click();
            }
          }
        }, { once: true });

      } else {
        feedback.innerText = "Incorrect. ‚ùå Please try again.";
        feedback.style.color = "red";
      }
    });
  });

  // Load user progress on page load
  window.addEventListener('DOMContentLoaded', () => {
    userProgress.completed.forEach(num => {
      enableTab(num);
      document.querySelector(`.complete-btn[data-btn="${num}"]`).classList.add('enabled');
      document.querySelector(`.complete-btn[data-btn="${num}"]`).disabled = false;
    });

    completedModules = userProgress.completed.length;

    if (completedModules === 4) {
      showCompletionPage();
    } else {
      enableTab("1");
      activateTab(userProgress.currentTab);
    }
  });
</script>
</body>
</html>
